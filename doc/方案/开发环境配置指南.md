# 开发环境配置指南

## 1. 开发工具安装

### 1.1 VS Code 配置

#### 必需扩展
```bash
# 在VS Code扩展商店安装以下扩展：

# TypeScript支持
- TypeScript and JavaScript Language Features

# React开发
- ES7+ React/Redux/React-Native snippets
- Auto Rename Tag
- Bracket Pair Colorizer

# 代码质量
- ESLint
- Prettier - Code formatter
- GitLens

# Three.js开发
- Three.js Snippets
- GLSL Preview

# 其他工具
- Thunder Client (API测试)
- Live Server (本地服务器)
- Material Icon Theme (图标主题)
```

#### VS Code 设置
```json
{
  "typescript.preferences.importModuleSpecifier": "relative",
  "editor.formatOnSave": true,
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true
  },
  "emmet.includeLanguages": {
    "typescript": "html",
    "typescriptreact": "html"
  }
}
```

### 1.2 Node.js 安装

#### Windows 安装
1. 访问 [Node.js官网](https://nodejs.org/)
2. 下载 LTS 版本 (推荐 18.x)
3. 运行安装程序，使用默认设置
4. 验证安装：
```bash
node --version
npm --version
```

#### 配置 npm 镜像 (可选)
```bash
# 设置淘宝镜像
npm config set registry https://registry.npmmirror.com

# 或使用 nrm 管理镜像
npm install -g nrm
nrm use taobao
```

### 1.3 Git 安装和配置

#### 安装 Git
1. 访问 [Git官网](https://git-scm.com/)
2. 下载并安装 Git for Windows
3. 验证安装：
```bash
git --version
```

#### Git 配置
```bash
# 配置用户信息
git config --global user.name "您的姓名"
git config --global user.email "您的邮箱"

# 配置默认编辑器
git config --global core.editor "code --wait"
```

## 2. 项目初始化

### 2.1 创建新项目
```bash
# 使用 Vite 创建 React + TypeScript 项目
npm create vite@latest 食道超声模拟软件 -- --template react-ts

# 进入项目目录
cd 食道超声模拟软件

# 安装依赖
npm install
```

### 2.2 安装必需依赖
```bash
# 核心依赖
npm install three @types/three
npm install @capacitor/core @capacitor/cli
npm install @capacitor/android @capacitor/ios

# UI 组件库
npm install @mui/material @emotion/react @emotion/styled
npm install @mui/icons-material

# 开发工具
npm install -D @types/node
npm install -D eslint @typescript-eslint/eslint-plugin @typescript-eslint/parser
npm install -D prettier eslint-config-prettier eslint-plugin-prettier
```

### 2.3 Three.js 相关依赖
```bash
# Three.js 加载器
npm install three-stdlib

# 或单独安装需要的加载器
npm install three/examples/jsm/loaders/STLLoader
npm install three/examples/jsm/loaders/OBJLoader
npm install three/examples/jsm/controls/OrbitControls
```

## 3. Capacitor 配置

### 3.1 初始化 Capacitor
```bash
# 在项目根目录执行
npx cap init 食道超声模拟软件 com.example.ultrasound

# 添加 Android 平台
npx cap add android

# 添加 iOS 平台 (如果需要)
npx cap add ios
```

### 3.2 Capacitor 配置文件
```json
// capacitor.config.ts
import { CapacitorConfig } from '@capacitor/cli';

const config: CapacitorConfig = {
  appId: 'com.example.ultrasound',
  appName: '食道超声模拟软件',
  webDir: 'dist',
  server: {
    androidScheme: 'https'
  },
  plugins: {
    Preferences: {},
    Filesystem: {
      androidPermissions: [
        'READ_EXTERNAL_STORAGE',
        'WRITE_EXTERNAL_STORAGE'
      ]
    }
  }
};

export default config;
```

## 4. 开发脚本配置

### 4.1 package.json 脚本
```json
{
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview",
    "cap:sync": "npm run build && npx cap sync",
    "cap:android": "npm run cap:sync && npx cap open android",
    "cap:ios": "npm run cap:sync && npx cap open ios",
    "cap:build:android": "npm run cap:sync && cd android && ./gradlew assembleDebug",
    "lint": "eslint . --ext ts,tsx --report-unused-disable-directives --max-warnings 0",
    "lint:fix": "eslint . --ext ts,tsx --fix"
  }
}
```

## 5. Android 开发环境

### 5.1 Android Studio 安装
1. 访问 [Android Studio官网](https://developer.android.com/studio)
2. 下载并安装 Android Studio
3. 安装时选择以下组件：
   - Android SDK
   - Android SDK Platform
   - Performance (Intel® HAXM)
   - Android Virtual Device

### 5.2 环境变量配置
```bash
# 设置 ANDROID_HOME 环境变量
# Windows:
setx ANDROID_HOME "C:\Users\用户名\AppData\Local\Android\Sdk"

# 将 platform-tools 和 tools 添加到 PATH
setx PATH "%PATH%;%ANDROID_HOME%\platform-tools;%ANDROID_HOME%\tools"
```

### 5.3 安装必要的 SDK
在 Android Studio 的 SDK Manager 中安装：
- Android SDK Platform 33
- Android SDK Build-Tools 33.0.0
- Android Emulator
- Android SDK Platform-Tools

## 6. 代码规范配置

### 6.1 ESLint 配置
```json
// .eslintrc.json
{
  "extends": [
    "eslint:recommended",
    "@typescript-eslint/recommended",
    "prettier"
  ],
  "parser": "@typescript-eslint/parser",
  "plugins": ["@typescript-eslint"],
  "rules": {
    "@typescript-eslint/no-unused-vars": "error",
    "@typescript-eslint/explicit-function-return-type": "off",
    "@typescript-eslint/explicit-module-boundary-types": "off"
  }
}
```

### 6.2 Prettier 配置
```json
// .prettierrc
{
  "semi": true,
  "trailingComma": "es5",
  "singleQuote": true,
  "printWidth": 80,
  "tabWidth": 2
}
```

## 7. 开发工作流

### 7.1 日常开发流程
```bash
# 1. 启动开发服务器
npm run dev

# 2. 在浏览器中测试 http://localhost:5173

# 3. 代码修改后自动热重载

# 4. 构建测试
npm run build

# 5. 同步到移动平台
npm run cap:sync
```

### 7.2 移动端测试
```bash
# Android 测试
npm run cap:android
# 在 Android Studio 中运行模拟器或连接真机

# iOS 测试 (需要 macOS)
npm run cap:ios
# 在 Xcode 中运行模拟器或连接真机
```

## 8. 调试配置

### 8.1 VS Code 调试配置
```json
// .vscode/launch.json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Launch Chrome",
      "request": "launch",
      "type": "node",
      "program": "${workspaceFolder}/node_modules/vite/bin/vite.js",
      "args": ["--port", "5173"],
      "serverReadyAction": {
        "pattern": "Local:.+(https?://[^:]+:(\\d+))",
        "uriFormat": "%s",
        "action": "debugWithChrome"
      }
    }
  ]
}
```

### 8.2 Chrome 开发者工具
- 使用 F12 打开开发者工具
- 在 Sources 面板调试 TypeScript
- 使用 Performance 面板分析3D渲染性能

## 9. 常见问题解决

### 9.1 依赖安装问题
```bash
# 清除缓存重新安装
npm cache clean --force
rm -rf node_modules package-lock.json
npm install
```

### 9.2 Capacitor 同步问题
```bash
# 删除平台重新添加
npx cap rm android
npx cap add android
npx cap sync
```

### 9.3 Three.js 类型问题
确保安装了正确的类型定义：
```bash
npm install @types/three
```

## 10. 性能优化建议

### 10.1 开发阶段优化
- 使用 Vite 的热重载功能
- 启用 Tree Shaking 减少打包体积
- 使用代码分割按需加载

### 10.2 生产构建优化
```bash
# 分析打包体积
npm install -D rollup-plugin-visualizer
```

在 vite.config.ts 中添加：
```typescript
import { visualizer } from 'rollup-plugin-visualizer';

export default defineConfig({
  plugins: [visualizer()],
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          three: ['three'],
          vendor: ['react', 'react-dom']
        }
      }
    }
  }
});
```

这个配置指南将帮助您快速搭建完整的开发环境，开始食道超声模拟软件的开发工作。
