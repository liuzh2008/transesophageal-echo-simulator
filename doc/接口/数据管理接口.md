# **数据管理接口文档**

## **PatientData类接口**

**接口路径**: `src/data/models/PatientData.ts`

**功能说明**: 病人数据模型类，负责病人数据的存储、验证和序列化

**请求参数**:
- `PatientDataProps` 接口参数：
  - `name`: string - 病人姓名（必填）
  - `age`: number - 病人年龄（必填）
  - `diagnosis`: string - 诊断信息（可选）
  - `gender`: 'male' | 'female' | 'other' - 性别（可选）
  - `examinationDate`: Date - 检查日期（可选）

**响应格式**:
- `ValidationResult` 接口：
  - `isValid`: boolean - 验证是否通过
  - `errors`: string[] - 错误信息列表

**逻辑**:
1. 构造函数自动对姓名和诊断信息进行trim处理
2. 验证规则包括：姓名非空且长度≤50，年龄在1-150之间，诊断信息长度≤200
3. 提供JSON序列化和反序列化方法

**响应示例**:
```typescript
// 创建病人数据
const patient = new PatientData({
  name: '张三',
  age: 45,
  diagnosis: '心脏检查',
  gender: 'male'
});

// 验证数据
const validation = patient.isValid();
// 返回: { isValid: true, errors: [] }

// 序列化
const json = patient.toJSON();
// 返回: { name: '张三', age: 45, diagnosis: '心脏检查', gender: 'male', examinationDate: null }
```

**相关文件**: `src/data/models/PatientData.ts`

---

## **LocalStorageService类接口**

**接口路径**: `src/data/services/LocalStorageService.ts`

**功能说明**: 本地存储服务，提供浏览器localStorage的封装

**请求参数**:
- `save` 方法：
  - `key`: string - 存储键
  - `data`: T - 要存储的数据
- `load` 方法：
  - `key`: string - 存储键
- `remove` 方法：
  - `key`: string - 存储键

**响应格式**:
- `StorageResult<T>` 接口：
  - `success`: boolean - 操作是否成功
  - `data`: T - 返回的数据（仅load方法）
  - `error`: string - 错误信息

**逻辑**:
1. 所有操作都包含错误处理
2. 自动进行JSON序列化和反序列化
3. 验证存储键的有效性
4. 提供数据存在性检查和存储键列表功能

**响应示例**:
```typescript
const storage = new LocalStorageService();

// 保存数据
const saveResult = storage.save('test-key', { name: '测试' });
// 返回: { success: true }

// 加载数据
const loadResult = storage.load<{ name: string }>('test-key');
// 返回: { success: true, data: { name: '测试' } }

// 检查存在性
const exists = storage.exists('test-key');
// 返回: true
```

**相关文件**: `src/data/services/LocalStorageService.ts`

---

## **DataManager类接口**

**接口路径**: `src/data/DataManager.ts`

**功能说明**: 数据管理器，负责病人数据的持久化管理和业务逻辑

**请求参数**:
- `savePatient` 方法：
  - `patientData`: PatientDataProps - 病人数据
- `loadPatient` 方法：
  - `name`: string - 病人姓名
- `deletePatient` 方法：
  - `name`: string - 病人姓名
- `updatePatient` 方法：
  - `name`: string - 病人姓名
  - `updatedData`: Partial<PatientDataProps> - 更新的数据

**响应格式**:
- `DataManagerResult<T>` 接口：
  - `success`: boolean - 操作是否成功
  - `data`: T - 返回的数据
  - `error`: string - 错误信息

**逻辑**:
1. 在保存前自动验证病人数据
2. 使用病人姓名生成唯一的存储键
3. 记录数据的创建时间和更新时间
4. 提供病人列表查询和存储统计功能

**响应示例**:
```typescript
const manager = new DataManager();

// 保存病人数据
const saveResult = manager.savePatient({
  name: '李四',
  age: 35,
  diagnosis: '心脏检查'
});
// 返回: { success: true, data: 'patient_李四' }

// 加载病人数据
const loadResult = manager.loadPatient('李四');
// 返回: { 
//   success: true, 
//   data: {
//     id: 'patient_李四',
//     data: { name: '李四', age: 35, diagnosis: '心脏检查' },
//     createdAt: '2025-11-08T07:15:00.000Z',
//     updatedAt: '2025-11-08T07:15:00.000Z'
//   }
// }

// 获取所有病人
const patientsResult = manager.getAllPatients();
// 返回: { success: true, data: [...] }
```

**相关文件**: `src/data/DataManager.ts`

---

## **测试接口**

**接口路径**: `tests/data/patient-data.test.ts`

**功能说明**: 数据管理功能的测试用例

**测试覆盖**:
1. 病人数据模型创建和验证
2. 本地存储操作功能
3. 数据持久化功能
4. 错误处理和边界条件

**测试方法**:
- 使用Jest测试框架
- 模拟localStorage环境
- 验证功能正确性和错误处理

**相关文件**: `tests/data/patient-data.test.ts`
