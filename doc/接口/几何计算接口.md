# 几何计算接口文档

## 概述
几何计算模块提供三维空间中的基础几何运算功能，包括向量运算、平面计算、矩阵变换和几何求交算法。

## 核心接口

### Vector3 类
**功能说明**：三维向量运算，支持向量加减、点积、叉积、归一化等基本运算。

**构造函数**：
```typescript
new Vector3(x: number, y: number, z: number)
```

**主要方法**：
- `add(v: Vector3): Vector3` - 向量加法
- `subtract(v: Vector3): Vector3` - 向量减法
- `multiplyScalar(scalar: number): Vector3` - 标量乘法
- `dot(v: Vector3): number` - 向量点积
- `cross(v: Vector3): Vector3` - 向量叉积
- `length(): number` - 向量长度
- `normalize(): Vector3` - 向量归一化
- `clone(): Vector3` - 向量克隆
- `equals(v: Vector3, tolerance?: number): boolean` - 向量相等判断

**响应示例**：
```typescript
const v1 = new Vector3(1, 2, 3);
const v2 = new Vector3(4, 5, 6);
const sum = v1.add(v2); // Vector3 { x: 5, y: 7, z: 9 }
const dot = v1.dot(v2); // 32
```

### Plane 类
**功能说明**：三维空间中的平面定义和计算，支持平面方程、点面距离、投影等运算。

**构造函数**：
```typescript
new Plane(normal: Vector3, constant: number = 0)
```

**静态方法**：
- `fromPointAndNormal(point: Vector3, normal: Vector3): Plane` - 通过点和法向量创建平面
- `fromPoints(point1: Vector3, point2: Vector3, point3: Vector3): Plane` - 通过三个点创建平面

**主要方法**：
- `distanceToPoint(point: Vector3): number` - 点到平面距离
- `projectPoint(point: Vector3): Vector3` - 点在平面上的投影
- `containsPoint(point: Vector3, tolerance?: number): boolean` - 判断点是否在平面上
- `getAnyPoint(): Vector3` - 获取平面上的任意一点
- `intersectPlane(other: Plane): { point: Vector3; direction: Vector3 } | null` - 平面相交计算
- `clone(): Plane` - 平面克隆
- `equals(other: Plane, tolerance?: number): boolean` - 平面相等判断

**响应示例**：
```typescript
const plane = new Plane(new Vector3(0, 1, 0), -2); // 平面 y = 2
const point = new Vector3(1, 5, 3);
const distance = plane.distanceToPoint(point); // 3
const projection = plane.projectPoint(point); // Vector3 { x: 1, y: 2, z: 3 }
```

### Matrix4 类
**功能说明**：4x4变换矩阵，支持平移、旋转、缩放等变换操作。

**构造函数**：
```typescript
new Matrix4()
```

**主要方法**：
- `identity(): Matrix4` - 单位矩阵
- `makeTranslation(x: number, y: number, z: number): Matrix4` - 创建平移矩阵
- `makeRotationX(angle: number): Matrix4` - 创建绕X轴旋转矩阵
- `makeRotationY(angle: number): Matrix4` - 创建绕Y轴旋转矩阵
- `makeRotationZ(angle: number): Matrix4` - 创建绕Z轴旋转矩阵
- `transformVector(vector: Vector3): Vector3` - 向量变换

**响应示例**：
```typescript
const matrix = new Matrix4();
const translation = matrix.makeTranslation(1, 2, 3);
const vector = new Vector3(4, 5, 6);
const transformed = translation.transformVector(vector); // Vector3 { x: 5, y: 7, z: 9 }
```

### TriangleIntersection 类
**功能说明**：平面与三角形求交算法，计算平面与三角形的交点。

**静态方法**：
- `planeTriangleIntersection(plane: Plane, triangle: [Vector3, Vector3, Vector3], tolerance?: number): Vector3[]` - 平面与三角形求交
- `intersectsPlane(plane: Plane, triangle: [Vector3, Vector3, Vector3], tolerance?: number): boolean` - 检查三角形是否与平面相交

**便捷函数**：
- `planeTriangleIntersection(plane: Plane, triangle: [Vector3, Vector3, Vector3], tolerance?: number): Vector3[]` - 平面与三角形求交

**响应示例**：
```typescript
const plane = new Plane(new Vector3(0, 0, 1), 0); // 平面 z = 0
const triangle: [Vector3, Vector3, Vector3] = [
  new Vector3(-1, -1, -1),
  new Vector3(1, -1, 1),
  new Vector3(0, 1, 0)
];
const intersections = planeTriangleIntersection(plane, triangle);
// 返回交点数组，包含2个交点
```

## 使用示例

### 基础几何运算
```typescript
import { Vector3, Plane } from '../src/core/algorithms/geometry/index';

// 向量运算
const v1 = new Vector3(1, 2, 3);
const v2 = new Vector3(4, 5, 6);
const cross = v1.cross(v2); // 叉积

// 平面计算
const plane = Plane.fromPointAndNormal(new Vector3(0, 0, 0), new Vector3(0, 1, 0));
const distance = plane.distanceToPoint(new Vector3(1, 5, 3)); // 5
```

### 几何求交计算
```typescript
import { planeTriangleIntersection } from '../src/core/algorithms/geometry/index';

const plane = new Plane(new Vector3(0, 0, 1), 0);
const triangle: [Vector3, Vector3, Vector3] = [
  new Vector3(-1, -1, -1),
  new Vector3(1, -1, 1),
  new Vector3(0, 1, 0)
];

const intersections = planeTriangleIntersection(plane, triangle);
// 返回交点数组，可用于切面轮廓计算
```

## 边界情况处理

### 浮点数精度
所有几何计算都支持浮点数精度容差参数，默认容差为 `1e-10`。

### 退化情况
- 零向量归一化返回零向量
- 非法平面参数（零法向量）抛出错误
- 退化三角形（三点共线）特殊处理

### 错误处理
- 零法向量创建平面会抛出错误
- 非法矩阵操作返回合理结果
- 求交失败返回空数组或null

## 性能考虑

### 计算复杂度
- 向量运算：O(1)
- 平面计算：O(1)
- 矩阵变换：O(1)
- 三角形求交：O(1)

### 内存使用
所有几何对象都支持克隆操作，避免不必要的对象创建。

## 相关文件
- `src/core/algorithms/geometry/Vector3.ts` - 向量运算实现
- `src/core/algorithms/geometry/Plane.ts` - 平面计算实现
- `src/core/algorithms/geometry/Matrix4.ts` - 矩阵变换实现
- `src/core/algorithms/geometry/TriangleIntersection.ts` - 求交算法实现
- `tests/unit/algorithms/geometry.test.ts` - 几何计算测试
- `tests/unit/algorithms/intersection.test.ts` - 求交算法测试

## 更新历史
- **2025-11-11**: 创建几何计算接口文档，包含Vector3、Plane、Matrix4、TriangleIntersection接口
- **2025-11-11**: 添加平面-三角形求交算法接口说明
- **2025-11-11**: 完善使用示例和边界情况处理说明
