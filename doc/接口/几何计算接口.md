# 几何计算接口文档

## Vector3 向量类接口

**接口路径**: `src/core/algorithms/geometry/Vector3.ts`

**功能说明**: 三维向量运算类，提供向量基本运算和几何计算功能

**请求参数**:
- 构造函数参数: `x: number, y: number, z: number` - 向量的三个分量
- 方法参数: 各方法接收相应的向量或标量参数

**响应格式**: 返回新的Vector3实例或数值结果

**逻辑**:
- 支持向量加减法、点积、叉积、归一化等基本运算
- 提供向量长度计算和相等性判断
- 包含浮点数精度处理和边界情况处理

**响应示例**:
```typescript
const v1 = new Vector3(1, 2, 3);
const v2 = new Vector3(4, 5, 6);
const sum = v1.add(v2); // Vector3(5, 7, 9)
const dot = v1.dot(v2); // 32
const cross = v1.cross(v2); // Vector3(-3, 6, -3)
```

**相关文件**:
- `src/core/algorithms/geometry/Vector3.ts`
- `tests/unit/algorithms/geometry.test.ts`

---

## Plane 平面类接口

**接口路径**: `src/core/algorithms/geometry/Plane.ts`

**功能说明**: 三维空间平面定义和计算类，支持平面相交和点面关系计算

**请求参数**:
- 构造函数参数: `normal: Vector3, constant: number` - 法向量和常数项
- 静态方法参数: 点坐标或法向量参数

**响应格式**: 返回平面计算结果或交线信息

**逻辑**:
- 支持通过点和法向量、三个点创建平面
- 计算点到平面距离和投影
- 支持平面相交计算和交线求解
- 包含浮点数精度处理和边界情况处理

**响应示例**:
```typescript
const plane = Plane.fromPointAndNormal(new Vector3(0, 0, 0), new Vector3(0, 1, 0));
const distance = plane.distanceToPoint(new Vector3(1, 5, 3)); // 5
const projection = plane.projectPoint(new Vector3(1, 5, 3)); // Vector3(1, 0, 3)
```

**相关文件**:
- `src/core/algorithms/geometry/Plane.ts`
- `tests/unit/algorithms/geometry.test.ts`

---

## Matrix4 矩阵类接口

**接口路径**: `src/core/algorithms/geometry/Matrix4.ts`

**功能说明**: 4x4变换矩阵类，支持三维空间中的各种变换操作

**请求参数**:
- 构造函数参数: 无参数，默认创建单位矩阵
- 方法参数: 变换参数（平移向量、旋转角度、缩放因子等）

**响应格式**: 返回变换后的矩阵或向量

**逻辑**:
- 支持平移、旋转、缩放等基本变换
- 提供矩阵乘法、逆矩阵、转置矩阵计算
- 支持向量变换和坐标转换
- 包含视图矩阵和透视投影矩阵创建

**响应示例**:
```typescript
const matrix = new Matrix4();
const translation = matrix.makeTranslation(1, 2, 3);
const vector = new Vector3(4, 5, 6);
const transformed = translation.transformVector(vector); // Vector3(5, 7, 9)
```

**相关文件**:
- `src/core/algorithms/geometry/Matrix4.ts`
- `tests/unit/algorithms/geometry.test.ts`

---

## 几何计算模块导出接口

**接口路径**: `src/core/algorithms/geometry/index.ts`

**功能说明**: 几何计算模块的统一导出接口

**请求参数**: 无

**响应格式**: 导出Vector3、Plane、Matrix4类

**逻辑**:
- 提供统一的模块导出接口
- 简化其他模块对几何计算类的引用

**响应示例**:
```typescript
import { Vector3, Plane, Matrix4 } from '../../../src/core/algorithms/geometry/index';
```

**相关文件**:
- `src/core/algorithms/geometry/index.ts`
- `tests/unit/algorithms/geometry.test.ts`

---

## 几何计算测试接口

**接口路径**: `tests/unit/algorithms/geometry.test.ts`

**功能说明**: 几何计算模块的完整测试套件

**请求参数**: 测试用例参数

**响应格式**: 测试通过或失败结果

**逻辑**:
- 测试向量运算的正确性和边界情况
- 验证平面计算和相交算法的准确性
- 检查矩阵变换和坐标转换的正确性
- 验证浮点数精度处理和错误处理

**响应示例**:
```typescript
test('向量点积', () => {
  const v1 = new Vector3(1, 2, 3);
  const v2 = new Vector3(4, 5, 6);
  expect(v1.dot(v2)).toBe(32);
});
```

**相关文件**:
- `tests/unit/algorithms/geometry.test.ts`
- `src/core/algorithms/geometry/` 目录下所有文件

---

## 接口设计原则

### 1. 类型安全
- 所有接口使用TypeScript严格类型定义
- 参数验证和错误处理机制完善
- 返回类型明确，避免运行时错误

### 2. 性能优化
- 避免不必要的对象创建
- 使用浮点数精度容差处理
- 支持链式调用和原地操作

### 3. 可扩展性
- 模块化设计，便于添加新功能
- 接口设计考虑未来扩展需求
- 支持多种构造方式和计算方法

### 4. 测试覆盖
- 完整的单元测试覆盖
- 边界情况和异常情况测试
- 性能基准测试和回归测试

---

## 使用示例

### 基本向量运算
```typescript
import { Vector3 } from '../../../src/core/algorithms/geometry/index';

// 创建向量
const v1 = new Vector3(1, 2, 3);
const v2 = new Vector3(4, 5, 6);

// 向量运算
const sum = v1.add(v2);
const dot = v1.dot(v2);
const cross = v1.cross(v2);
const normalized = v1.normalize();
```

### 平面计算
```typescript
import { Plane, Vector3 } from '../../../src/core/algorithms/geometry/index';

// 创建平面
const plane1 = Plane.fromPointAndNormal(new Vector3(0, 0, 0), new Vector3(0, 1, 0));
const plane2 = Plane.fromPoints(
  new Vector3(0, 0, 0),
  new Vector3(1, 0, 0),
  new Vector3(0, 1, 0)
);

// 平面计算
const distance = plane1.distanceToPoint(new Vector3(1, 5, 3));
const projection = plane1.projectPoint(new Vector3(1, 5, 3));
```

### 矩阵变换
```typescript
import { Matrix4, Vector3 } from '../../../src/core/algorithms/geometry/index';

// 创建变换矩阵
const matrix = new Matrix4();
const transform = matrix
  .makeTranslation(1, 2, 3)
  .makeRotationX(Math.PI / 4)
  .makeScale(2, 2, 2);

// 向量变换
const vector = new Vector3(1, 0, 0);
const transformed = transform.transformVector(vector);
```

---

## 错误处理

### 参数验证
- 零向量归一化返回零向量
- 非法平面参数抛出错误
- 矩阵不可逆时返回null

### 精度处理
- 使用1e-10作为默认精度容差
- 浮点数比较使用容差范围
- 边界情况特殊处理

---

## 性能考虑

### 计算优化
- 避免重复计算
- 使用缓存机制
- 优化矩阵运算

### 内存管理
- 最小化对象创建
- 支持原地操作
- 及时释放资源

---

## 版本历史

- **v1.0.0** (2025-11-11): 初始版本，包含Vector3、Plane、Matrix4基础几何计算类
- 完整的测试覆盖和接口文档
- 支持切面计算算法的基础数学运算
