# 切面可视化接口文档

## 接口概述
切面可视化服务负责处理切面轮廓的可视化配置和显示，支持颜色、线宽、高亮、透明度等可视化选项。

## 核心接口

### VisualizationConfig 接口
**功能说明**：切面可视化配置接口，定义切面轮廓的显示参数。

**接口定义**：
```typescript
interface VisualizationConfig {
  visible: boolean;      // 是否可见
  lineWidth: number;     // 线宽
  color: string;         // 颜色（十六进制格式）
  opacity: number;       // 透明度（0-1）
  highlight: boolean;    // 是否高亮显示
}
```

**参数说明**：
- `visible`: 控制切面轮廓是否显示
- `lineWidth`: 切面轮廓线的宽度，单位像素
- `color`: 切面轮廓的颜色，支持十六进制格式（如#00ff00）
- `opacity`: 切面轮廓的透明度，0为完全透明，1为完全不透明
- `highlight`: 是否启用高亮显示模式

### VisualizationOptions 接口
**功能说明**：可视化选项接口，用于自定义切面显示效果。

**接口定义**：
```typescript
interface VisualizationOptions {
  color?: string;           // 自定义颜色
  lineWidth?: number;       // 自定义线宽
  opacity?: number;         // 自定义透明度
  highlight?: boolean;      // 是否启用高亮
  highlightColor?: string;  // 高亮颜色
}
```

**参数说明**：
- `color`: 可选，自定义切面颜色
- `lineWidth`: 可选，自定义线宽
- `opacity`: 可选，自定义透明度
- `highlight`: 可选，是否启用高亮显示
- `highlightColor`: 可选，高亮显示时的颜色

## 服务接口

### SectionVisualizationService 类
**功能说明**：切面可视化服务，提供切面轮廓的可视化配置功能。

#### getVisualizationConfig 方法
**功能说明**：获取切面可视化配置。

**请求参数**：
- `intersectionLines: Vector3[][]` - 切面交线数据
- `options: VisualizationOptions = {}` - 可视化选项

**响应格式**：
```typescript
VisualizationConfig {
  visible: boolean;
  lineWidth: number;
  color: string;
  opacity: number;
  highlight: boolean;
}
```

**逻辑说明**：
1. 验证输入的交线数据有效性
2. 处理空交线数据，返回不可见配置
3. 应用自定义可视化选项
4. 处理高亮显示逻辑
5. 返回最终的可视化配置

**响应示例**：
```typescript
// 正常切面配置
{
  visible: true,
  lineWidth: 2,
  color: '#00ff00',
  opacity: 1.0,
  highlight: false
}

// 高亮切面配置
{
  visible: true,
  lineWidth: 3,
  color: '#ffff00',
  opacity: 1.0,
  highlight: true
}

// 空交线配置
{
  visible: false,
  lineWidth: 0,
  color: '#00ff00',
  opacity: 1.0,
  highlight: false
}
```

#### getDefaultConfig 方法
**功能说明**：获取默认的可视化配置。

**请求参数**：无

**响应格式**：
```typescript
VisualizationConfig
```

**逻辑说明**：返回服务的默认配置

**响应示例**：
```typescript
{
  visible: true,
  lineWidth: 2,
  color: '#00ff00',
  opacity: 1.0,
  highlight: false
}
```

#### setDefaultConfig 方法
**功能说明**：设置默认的可视化配置。

**请求参数**：
- `config: Partial<VisualizationConfig>` - 部分配置更新

**响应格式**：无

**逻辑说明**：更新服务的默认配置

## 相关文件

### 核心实现文件
- `src/core/algorithms/services/SectionVisualizationService.ts` - 切面可视化服务实现
- `tests/unit/algorithms/section-visualization.test.ts` - 切面可视化服务测试

### 依赖文件
- `src/core/algorithms/geometry/Vector3.ts` - 三维向量类
- `src/core/algorithms/services/RealTimeUpdateService.ts` - 实时切面更新服务

## 使用示例

### 基本使用
```typescript
import { SectionVisualizationService } from '../core/algorithms/services/SectionVisualizationService';
import { Vector3 } from '../core/algorithms/geometry/index';

// 创建服务实例
const visualizationService = new SectionVisualizationService();

// 模拟切面交线数据
const intersectionLines = [
  [new Vector3(-1, 0, 0), new Vector3(1, 0, 0)],
  [new Vector3(0, -1, 0), new Vector3(0, 1, 0)]
];

// 获取默认可视化配置
const defaultConfig = visualizationService.getVisualizationConfig(intersectionLines);

// 使用自定义选项
const customConfig = visualizationService.getVisualizationConfig(intersectionLines, {
  color: '#ff0000',
  lineWidth: 3,
  opacity: 0.8,
  highlight: true
});
```

### 高亮显示
```typescript
// 启用高亮显示
const highlightConfig = visualizationService.getVisualizationConfig(intersectionLines, {
  highlight: true,
  highlightColor: '#ffff00'
});

// 自定义高亮颜色
const customHighlightConfig = visualizationService.getVisualizationConfig(intersectionLines, {
  highlight: true,
  highlightColor: '#ff00ff'
});
```

### 错误处理
```typescript
// 处理空交线数据
const emptyLines: Vector3[][] = [];
const emptyConfig = visualizationService.getVisualizationConfig(emptyLines);
// 返回 { visible: false, lineWidth: 0, ... }

// 处理无效数据格式
const invalidLines = [[new Vector3(0, 0, 0)]] as Vector3[][];
const invalidConfig = visualizationService.getVisualizationConfig(invalidLines);
// 返回 { visible: false, ... }
```

## 性能考虑

- **计算性能**：大量交线数据（1000条线段）的可视化配置计算时间 < 50ms
- **内存使用**：配置对象轻量，不存储大量数据
- **实时性**：支持实时切面更新的可视化配置需求

## 错误处理

- **空交线数据**：返回不可见配置，线宽设为0
- **无效数据格式**：过滤无效数据，返回不可见配置
- **边界值处理**：透明度限制在0-1范围内，线宽确保非负
- **颜色验证**：验证颜色格式有效性，使用默认颜色替代无效颜色

## 扩展性

- 支持自定义颜色、线宽、透明度等可视化参数
- 支持高亮显示模式，可自定义高亮颜色
- 易于扩展新的可视化效果和配置选项
- 模块化设计，便于与其他切面计算模块集成
